import{d as ge,u as pe,r as f,c as w,E as ye,C as v,b as x,w as l,e,f as _e,o as u,g as t,I as ke,h as Q,i as Ce,j as s,z as be,x as r,G as g,H as Ie,a7 as he,a8 as N,a3 as M,k as xe,n as m,p as P,l as i,F as Pe,m as R,q as Re,s as A,t as O,v as d,a9 as Ve,N as j,O as X,P as Y,Q as J,R as K,S as Z,W as ee,Y as ae,X as te,aa as le,ab as ne,ac as oe,ad as se,ae as ie,y as Se}from"./index-yNZZBFxb.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={key:0},$e={class:"ion-text-center ion-padding"},Ee=["src"],Be={class:"ion-padding"},Ue={key:1},Ne={class:"ion-padding"},Me={key:0,class:"ion-text-center"},Ae={class:"image-container"},Oe=["src"],Te={class:"recipe-meta"},De={class:"meta-info"},Fe={key:2,class:"pagination"},Ge={key:2},Le={key:0,class:"ion-text-center"},qe={class:"image-container"},We=["src"],He={class:"recipe-meta"},Qe={class:"meta-info"},je={key:2,class:"pagination"},C=8,Xe=ge({__name:"ProfilePage",setup(Ye){const _=_e(),c=pe(),b=f("info"),I=f(""),V=f(""),k=f(""),S=f(!1),z=f([]),$=f([]),p=f(1),y=f(1),T=w(()=>{const n=(p.value-1)*C;return z.value.slice(n,n+C)}),D=w(()=>{const n=(y.value-1)*C;return $.value.slice(n,n+C)}),E=w(()=>Math.ceil(z.value.length/C)),B=w(()=>Math.ceil($.value.length/C));ye(async()=>{var n,a,o;I.value=((n=c.user)==null?void 0:n.name)||"",V.value=((a=c.user)==null?void 0:a.email)||"",k.value=((o=c.user)==null?void 0:o.avatar)||"",await U()});async function U(){var a;const n=(a=v.authStore.model)==null?void 0:a.id;if(n)try{const o=await v.collection("recipes").getFullList({filter:'author = "'.concat(n,'"'),sort:"-created"});z.value=o,$.value=c.savedRecipes||[]}catch(o){console.error(o)}}function F(n){p.value=n}function G(n){y.value=n}function ue(){c.logout(),_.replace("/login")}function re(n){_.push("/recipes/".concat(n.id,"/edit"))}async function de(n){if(confirm("¿Borrar receta?"))try{await v.collection("recipes").delete(n.id),await U()}catch(a){console.error(a)}}async function ce(n){if(confirm("¿Quitar de guardadas?"))try{await c.toggleSaved(n.id),await U()}catch(a){console.error(a),alert(a.message||"Error al quitar de guardadas")}}function L(n){return n==="entrante"?"success":n==="principal"?"primary":n==="postre"?"warning":"medium"}function q(n){return n==="facil"?"green":n==="media"?"orange":n==="dificil"?"red":"gray"}function W(n){if(n.image){if(typeof n.image=="string"&&(n.image.startsWith("http://")||n.image.startsWith("https://")))return n.image;if(v.baseUrl)try{return v.files.getUrl(n,n.image,{thumb:"300x300"})}catch(a){return"https://via.placeholder.com/300x200?text=Receta"}}return"https://via.placeholder.com/300x200?text=Receta"}function H(n){n.target.src="https://via.placeholder.com/300x200?text=Receta"}async function fe(){var n;S.value=!0;try{const a=(n=v.authStore.model)==null?void 0:n.id;if(!a)return;const o={name:I.value,avatar:k.value};await v.collection("users").update(a,o),c.user={...c.user,...o},alert("Perfil actualizado")}catch(a){console.error(a),alert("Error al actualizar")}finally{S.value=!1}}async function ve(){var n;if(confirm("¿Seguro que quieres borrar tu perfil? Esta acción no se puede deshacer."))try{const a=(n=v.authStore.model)==null?void 0:n.id;if(!a)return;await v.collection("users").delete(a),c.logout(),_.replace("/login")}catch(a){console.error(a),alert("Error al eliminar cuenta")}}function me(){return k.value?k.value:"https://ui-avatars.com/api/?name="+encodeURIComponent(I.value||V.value||"Usuario")+"&background=random"}return(n,a)=>(u(),x(e(Se),null,{default:l(()=>[t(e(ke),null,{default:l(()=>[t(e(Q),null,{default:l(()=>[t(e(Ce),null,{default:l(()=>[...a[8]||(a[8]=[s("Mi Perfil",-1)])]),_:1}),t(e(be),{slot:"end"},{default:l(()=>[t(e(r),{onClick:ue},{default:l(()=>[t(e(g),{icon:e(Ie)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),t(e(Q),null,{default:l(()=>[t(e(he),{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=o=>b.value=o)},{default:l(()=>[t(e(N),{value:"info"},{default:l(()=>[t(e(M),null,{default:l(()=>[...a[9]||(a[9]=[s("Perfil",-1)])]),_:1})]),_:1}),t(e(N),{value:"mis-recetas"},{default:l(()=>[t(e(M),null,{default:l(()=>[...a[10]||(a[10]=[s("Mis Recetas",-1)])]),_:1})]),_:1}),t(e(N),{value:"guardadas"},{default:l(()=>[t(e(M),null,{default:l(()=>[...a[11]||(a[11]=[s("Guardadas",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(e(xe),{class:"ion-padding"},{default:l(()=>[b.value==="info"?(u(),m("div",ze,[i("div",$e,[t(e(Pe),{style:{width:"120px",height:"120px",margin:"0 auto"}},{default:l(()=>[i("img",{src:me(),alt:"Avatar"},null,8,Ee)]),_:1})]),i("form",{onSubmit:R(fe,["prevent"])},[t(e(Re),null,{default:l(()=>[t(e(A),null,{default:l(()=>[t(e(O),{label:"Nombre","label-placement":"floating",modelValue:I.value,"onUpdate:modelValue":a[1]||(a[1]=o=>I.value=o)},null,8,["modelValue"])]),_:1}),t(e(A),null,{default:l(()=>[t(e(O),{label:"Email","label-placement":"floating",modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=o=>V.value=o),readonly:""},null,8,["modelValue"])]),_:1}),t(e(A),null,{default:l(()=>[t(e(O),{label:"Avatar URL","label-placement":"floating",modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=o=>k.value=o)},null,8,["modelValue"])]),_:1})]),_:1}),i("div",Be,[t(e(r),{expand:"block",type:"submit",disabled:S.value},{default:l(()=>[s(d(S.value?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"]),t(e(r),{expand:"block",fill:"outline",color:"danger",onClick:ve},{default:l(()=>[...a[12]||(a[12]=[s(" Borrar Mi Cuenta ",-1)])]),_:1})])],32)])):P("",!0),b.value==="mis-recetas"?(u(),m("div",Ue,[i("div",Ne,[t(e(r),{expand:"block","router-link":"/recipes/new",color:"primary"},{default:l(()=>[t(e(g),{icon:e(Ve),slot:"start"},null,8,["icon"]),a[13]||(a[13]=s(" Crear Nueva Receta ",-1))]),_:1})]),T.value.length===0?(u(),m("p",Me,"No tienes recetas.")):(u(),x(e(j),{key:1},{default:l(()=>[t(e(X),null,{default:l(()=>[(u(!0),m(Y,null,J(T.value,o=>(u(),x(e(K),{size:"6","size-md":"4","size-lg":"3",key:o.id},{default:l(()=>[t(e(Z),{button:"",onClick:h=>e(_).push("/recipes/".concat(o.id)),class:"recipe-card"},{default:l(()=>[i("div",Ae,[i("img",{src:W(o),onError:H},null,40,Oe)]),t(e(ee),null,{default:l(()=>[t(e(ae),null,{default:l(()=>[s(d(o.title),1)]),_:2},1024),i("div",Te,[t(e(te),{color:L(o.category)},{default:l(()=>[s(d(o.category),1)]),_:2},1032,["color"]),i("div",De,[t(e(g),{icon:e(ne),style:le({color:q(o.difficulty)})},null,8,["icon","style"]),i("span",null,d(o.time)+"min",1)])])]),_:2},1024),t(e(oe),null,{default:l(()=>[t(e(r),{size:"small",fill:"outline",onClick:R(h=>re(o),["stop"])},{default:l(()=>[t(e(g),{icon:e(se),slot:"start"},null,8,["icon"]),a[14]||(a[14]=s(" Editar ",-1))]),_:1},8,["onClick"]),t(e(r),{size:"small",fill:"clear",color:"danger",onClick:R(h=>de(o),["stop"])},{default:l(()=>[t(e(g),{icon:e(ie),slot:"start"},null,8,["icon"]),a[15]||(a[15]=s(" Borrar ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})),E.value>1?(u(),m("div",Fe,[t(e(r),{disabled:p.value===1,onClick:a[4]||(a[4]=o=>F(p.value-1))},{default:l(()=>[...a[16]||(a[16]=[s("Anterior",-1)])]),_:1},8,["disabled"]),i("span",null,"Página "+d(p.value)+" de "+d(E.value),1),t(e(r),{disabled:p.value===E.value,onClick:a[5]||(a[5]=o=>F(p.value+1))},{default:l(()=>[...a[17]||(a[17]=[s("Siguiente",-1)])]),_:1},8,["disabled"])])):P("",!0)])):P("",!0),b.value==="guardadas"?(u(),m("div",Ge,[D.value.length===0?(u(),m("p",Le,"No tienes recetas guardadas.")):(u(),x(e(j),{key:1},{default:l(()=>[t(e(X),null,{default:l(()=>[(u(!0),m(Y,null,J(D.value,o=>(u(),x(e(K),{size:"6","size-md":"4","size-lg":"3",key:o.id},{default:l(()=>[t(e(Z),{button:"",onClick:h=>e(_).push("/recipes/".concat(o.id)),class:"recipe-card"},{default:l(()=>[i("div",qe,[i("img",{src:W(o),onError:H},null,40,We)]),t(e(ee),null,{default:l(()=>[t(e(ae),null,{default:l(()=>[s(d(o.title),1)]),_:2},1024),i("div",He,[t(e(te),{color:L(o.category)},{default:l(()=>[s(d(o.category),1)]),_:2},1032,["color"]),i("div",Qe,[t(e(g),{icon:e(ne),style:le({color:q(o.difficulty)})},null,8,["icon","style"]),i("span",null,d(o.time)+"min",1)])])]),_:2},1024),t(e(oe),null,{default:l(()=>[t(e(r),{size:"small",fill:"outline",onClick:R(h=>e(_).push("/recipes/".concat(o.id)),["stop"])},{default:l(()=>[t(e(g),{icon:e(se),slot:"start"},null,8,["icon"]),a[18]||(a[18]=s(" Ver ",-1))]),_:1},8,["onClick"]),t(e(r),{size:"small",fill:"clear",color:"danger",onClick:R(h=>ce(o),["stop"])},{default:l(()=>[t(e(g),{icon:e(ie),slot:"start"},null,8,["icon"]),a[19]||(a[19]=s(" Quitar de guardadas ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})),B.value>1?(u(),m("div",je,[t(e(r),{disabled:y.value===1,onClick:a[6]||(a[6]=o=>G(y.value-1))},{default:l(()=>[...a[20]||(a[20]=[s("Anterior",-1)])]),_:1},8,["disabled"]),i("span",null,"Página "+d(y.value)+" de "+d(B.value),1),t(e(r),{disabled:y.value===B.value,onClick:a[7]||(a[7]=o=>G(y.value+1))},{default:l(()=>[...a[21]||(a[21]=[s("Siguiente",-1)])]),_:1},8,["disabled"])])):P("",!0)])):P("",!0)]),_:1})]),_:1}))}}),Ze=we(Xe,[["__scopeId","data-v-0854054c"]]);export{Ze as default};
