import{B as le,C as H,d as ne,D as ie,u as se,r as J,E as oe,b as S,w as l,e,f as re,o as g,g as a,I as W,h as O,z as $,x as w,l as c,F as ue,v as p,G as I,H as de,J as ce,K as G,L as x,j as f,k as K,n as k,p as P,M as fe,N as ge,O as pe,P as B,Q as L,R as he,S as me,T as Q,m as ve,U as X,V as Y,W as ye,X as _e,Y as Ie,Z as ke,_ as Ce,$ as be,a0 as we,i as xe,a1 as D,a2 as Re,a3 as z,a4 as Se,a5 as Pe,a6 as Ee,y as Te}from"./index-yNZZBFxb.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae=le("recipes",{state:()=>({items:[],total:0,totalPages:1,page:1,limit:8,loading:!1,error:null,filters:{q:"",categoria:"",dificultad:""},selectedRecipe:null,detailsLoading:!1,detailsError:null}),actions:{async fetchRecipes(s={}){const u=s.append||!1;u||(this.loading=!0,this.items=[]),this.error=null,s.page&&(this.page=s.page);try{const o=[];this.filters.q&&o.push('title ~ "'.concat(this.filters.q,'"')),this.filters.categoria&&o.push('category = "'.concat(this.filters.categoria,'"')),this.filters.dificultad&&o.push('difficulty = "'.concat(this.filters.dificultad,'"'));const m=o.length>0?o.join(" && "):"",_=await H.collection("recipes").getList(this.page,this.limit,{filter:m,sort:"-created",expand:"author"}),v=_.items;u?this.items=[...this.items,...v]:this.items=v,this.page=_.page,this.totalPages=_.totalPages,this.total=_.totalItems}catch(o){this.error=o.message||"Error al cargar recetas",u||(this.items=[])}finally{this.loading=!1}},setSearch(s){this.filters.q=s,this.page=1},async goToPage(s){s<1||s>this.totalPages||(this.page=s,await this.fetchRecipes())},async fetchRecipeDetails(s){this.detailsLoading=!0,this.detailsError=null,this.selectedRecipe=null;try{const u=await H.collection("recipes").getOne(s,{expand:"author"});this.selectedRecipe=u}catch(u){this.detailsError=u.message||"Error al cargar detalles de la receta"}finally{this.detailsLoading=!1}},clearSelected(){this.selectedRecipe=null,this.detailsError=null}}}),Ve="/api";function $e(){const s=localStorage.getItem("token");return!s||s==="undefined"||s==="null"?null:s}async function A(s,u,o={}){const{body:m,params:_,auth:v}=o,R=new URL(Ve+u,window.location.origin);_&&Object.entries(_).forEach(([C,y])=>{y!=null&&y!==""&&R.searchParams.append(C,String(y))});const E={};if(m!=null&&(E["Content-Type"]="application/json"),v){const C=$e();if(!C)throw console.warn("API: Token required but not found in localStorage"),new Error("Token requerido");E.Authorization="Bearer ".concat(C)}const r=await fetch(R.toString(),{method:s,headers:E,body:m!=null?JSON.stringify(m):void 0});let h=null;const d=r.headers.get("content-type"),T=d&&d.includes("application/json");if(r.status!==204&&T&&(h=await r.json()),!r.ok){const C=(h==null?void 0:h.error)||(h==null?void 0:h.message)||"Error ".concat(r.status),y=new Error(C);throw y.status=r.status,y.data=h,y}return h}const Be={get(s,u={}){return A("GET",s,u)},delete(s,u={}){return A("DELETE",s,u)},post(s,u,o={}){return A("POST",s,{...o,body:u})},put(s,u,o={}){return A("PUT",s,{...o,body:u})}},Le=["src"],De={style:{"font-size":"0.8rem"}},ze={style:{display:"flex",gap:"10px",padding:"0 16px","align-items":"center"}},Ue={key:0,class:"ion-text-center ion-padding"},qe={key:1,class:"ion-text-center ion-padding color-danger"},Me=["onClick"],Ne=["src"],je={class:"badges"},Fe={style:{display:"flex","align-items":"center",gap:"5px"}},He={key:3,class:"ion-text-center ion-padding pagination-controls"},Je={class:"page-info"},We={key:4,class:"ion-text-center ion-padding muted"},Ge={class:"ion-text-center"},Ke=["src"],Qe={class:"ion-text-center"},Xe={class:"meta-row"},Ye={class:"details-section"},Ze={class:"details-section"},et=ne({__name:"HomePage",setup(s){const u=re(),o=Ae(),{items:m,loading:_,page:v,totalPages:R,filters:E}=ie(o),r=se(),h=J(!1),d=J(null);oe(()=>{C()});function T(){o.page=1,o.fetchRecipes()}async function C(){await o.fetchRecipes({page:1}),r.user&&await r.fetchProfile()}async function y(n){n<1||n>R.value||await o.fetchRecipes({page:n})}async function U(n){try{const t=await Be.get("/recipes/".concat(n.id));d.value=t.recipe||t,h.value=!0}catch(t){console.error(t),d.value=n,h.value=!0}}function q(){h.value=!1,d.value=null}function Z(n){return r.savedRecipeIds.has(n)}async function V(n){if(!r.user){alert("Inicia sesión para guardar recetas");return}try{await r.toggleSaved(n.id)}catch(t){alert(t.message||"Error al guardar receta")}}function M(n){return n&&(n.startsWith("http://")||n.startsWith("https://"))?n:"https://via.placeholder.com/300x200?text=Receta"}function N(n){n.target.src="https://via.placeholder.com/300x200?text=Receta"}function j(n){if(!n)return[];if(Array.isArray(n))return n;if(typeof n=="string")try{const t=JSON.parse(n);return Array.isArray(t)?t:[]}catch(t){return[]}return[]}function F(n){switch(n){case"entrante":return"success";case"principal":return"warning";case"postre":return"tertiary";default:return"medium"}}function ee(n){return n?new Date(n).toLocaleDateString():""}function te(){r.logout(),u.replace("/login")}function ae(){var n,t,i;return(n=r.user)!=null&&n.avatar?r.user.avatar:"https://ui-avatars.com/api/?name="+encodeURIComponent(((t=r.user)==null?void 0:t.name)||((i=r.user)==null?void 0:i.email)||"Usuario")+"&background=random"}return(n,t)=>(g(),S(e(Te),null,{default:l(()=>[a(e(W),null,{default:l(()=>[a(e(O),null,{default:l(()=>[a(e($),{slot:"start"},{default:l(()=>[a(e(w),{onClick:n.reload,fill:"clear",color:"dark"},{default:l(()=>[...t[7]||(t[7]=[c("strong",null,"Recetas",-1)])]),_:1},8,["onClick"])]),_:1}),a(e($),{slot:"end"},{default:l(()=>[a(e(w),{"router-link":"/tabs/profile",style:{display:"flex","align-items":"center",gap:"8px"}},{default:l(()=>{var i;return[a(e(ue),{style:{width:"32px",height:"32px"}},{default:l(()=>[c("img",{src:ae(),alt:"Avatar"},null,8,Le)]),_:1}),c("span",De,p(((i=e(r).user)==null?void 0:i.name)||"Mi Perfil"),1)]}),_:1}),a(e(w),{onClick:te},{default:l(()=>[a(e(I),{icon:e(de)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),a(e(O),null,{default:l(()=>[a(e(ce),{modelValue:n.search,"onUpdate:modelValue":t[0]||(t[0]=i=>n.search=i),placeholder:"Buscar recetas...",onIonInput:n.onSearchInput},null,8,["modelValue","onIonInput"])]),_:1}),a(e(O),null,{default:l(()=>[c("div",ze,[a(e(G),{modelValue:e(o).filters.categoria,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).filters.categoria=i),label:"Categoría","label-placement":"floating",fill:"outline",interface:"popover",style:{flex:"1"},onIonChange:T},{default:l(()=>[a(e(x),{value:""},{default:l(()=>[...t[8]||(t[8]=[f("Todas",-1)])]),_:1}),a(e(x),{value:"entrante"},{default:l(()=>[...t[9]||(t[9]=[f("Entrante",-1)])]),_:1}),a(e(x),{value:"principal"},{default:l(()=>[...t[10]||(t[10]=[f("Principal",-1)])]),_:1}),a(e(x),{value:"postre"},{default:l(()=>[...t[11]||(t[11]=[f("Postre",-1)])]),_:1})]),_:1},8,["modelValue"]),a(e(G),{modelValue:e(o).filters.dificultad,"onUpdate:modelValue":t[2]||(t[2]=i=>e(o).filters.dificultad=i),label:"Dificultad","label-placement":"floating",fill:"outline",interface:"popover",style:{flex:"1"},onIonChange:T},{default:l(()=>[a(e(x),{value:""},{default:l(()=>[...t[12]||(t[12]=[f("Todas",-1)])]),_:1}),a(e(x),{value:"facil"},{default:l(()=>[...t[13]||(t[13]=[f("Fácil",-1)])]),_:1}),a(e(x),{value:"media"},{default:l(()=>[...t[14]||(t[14]=[f("Media",-1)])]),_:1}),a(e(x),{value:"dificil"},{default:l(()=>[...t[15]||(t[15]=[f("Difícil",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),a(e(K),{class:"ion-padding"},{default:l(()=>[e(_)&&!e(m).length?(g(),k("div",Ue,[a(e(fe))])):P("",!0),n.error?(g(),k("div",qe,p(n.error),1)):P("",!0),e(m).length?(g(),S(e(ge),{key:2},{default:l(()=>[a(e(pe),null,{default:l(()=>[(g(!0),k(B,null,L(e(m),i=>(g(),S(e(he),{size:"12","size-sm":"6","size-md":"4","size-lg":"3",key:i.id},{default:l(()=>[a(e(me),{button:"",class:"recipe-card"},{default:l(()=>[c("div",{class:"image-container",onClick:b=>U(i)},[c("img",{src:M(i.image),onError:N,alt:"Recipe image"},null,40,Ne),a(e(Q),{size:"small",class:"bookmark-fab",onClick:ve(b=>V(i),["stop"]),color:e(r).savedRecipeIds.has(i.id)?"warning":"light"},{default:l(()=>[a(e(I),{icon:e(r).savedRecipeIds.has(i.id)?e(X):e(Y)},null,8,["icon"])]),_:2},1032,["onClick","color"])],8,Me),a(e(ye),{onClick:b=>U(i)},{default:l(()=>[c("div",je,[a(e(_e),{color:F(i.category)},{default:l(()=>[f(p(i.category),1)]),_:2},1032,["color"])]),a(e(Ie),{style:{"font-size":"1.1rem"}},{default:l(()=>[f(p(i.title),1)]),_:2},1024),a(e(ke),null,{default:l(()=>[c("span",Fe,[a(e(I),{icon:e(Ce),color:"warning",style:{"vertical-align":"text-bottom"}},null,8,["icon"]),f(" "+p(i.time)+" min | ",1),a(e(I),{icon:e(be),color:"success",style:{"vertical-align":"text-bottom"}},null,8,["icon"]),f(" "+p(i.difficulty),1)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):P("",!0),e(m).length||e(v)>1?(g(),k("div",He,[a(e(w),{fill:"clear",disabled:e(v)<=1,onClick:t[3]||(t[3]=i=>y(e(v)-1))},{default:l(()=>[...t[16]||(t[16]=[f(" < Anterior ",-1)])]),_:1},8,["disabled"]),c("span",Je,"Página "+p(e(v))+" de "+p(e(R)),1),a(e(w),{fill:"clear",disabled:e(v)>=e(R),onClick:t[4]||(t[4]=i=>y(e(v)+1))},{default:l(()=>[...t[17]||(t[17]=[f(" Siguiente > ",-1)])]),_:1},8,["disabled"])])):e(o).loading?P("",!0):(g(),k("div",We," No hay recetas que coincidan con tu búsqueda. "))]),_:1}),a(e(we),{"is-open":h.value,onDidDismiss:q},{default:l(()=>[a(e(W),null,{default:l(()=>[a(e(O),null,{default:l(()=>[a(e(xe),null,{default:l(()=>{var i;return[f(p((i=d.value)==null?void 0:i.titulo),1)]}),_:1}),a(e($),{slot:"end"},{default:l(()=>{var i;return[e(r).user&&Z((i=d.value)==null?void 0:i.id)?(g(),S(e(w),{key:0,color:"warning",onClick:t[5]||(t[5]=b=>V(d.value))},{default:l(()=>[a(e(I),{icon:e(X),slot:"icon-only"},null,8,["icon"])]),_:1})):e(r).user?(g(),S(e(w),{key:1,onClick:t[6]||(t[6]=b=>V(d.value))},{default:l(()=>[a(e(I),{icon:e(Y),slot:"icon-only"},null,8,["icon"])]),_:1})):P("",!0),a(e(w),{onClick:q},{default:l(()=>[...t[18]||(t[18]=[f("Cerrar",-1)])]),_:1})]}),_:1})]),_:1})]),_:1}),d.value?(g(),S(e(K),{key:0,class:"ion-padding"},{default:l(()=>[c("div",Ge,[c("img",{src:M(d.value.image),style:{"max-height":"250px","border-radius":"12px"},onError:N,alt:"Recipe image"},null,40,Ke)]),c("h2",Qe,p(d.value.title),1),c("div",Xe,[a(e(D),null,{default:l(()=>[a(e(I),{icon:e(Re)},null,8,["icon"]),a(e(z),null,{default:l(()=>[f(p(ee(d.value.created_at)),1)]),_:1})]),_:1}),a(e(D),null,{default:l(()=>[a(e(I),{icon:e(Se)},null,8,["icon"]),a(e(z),null,{default:l(()=>[f("Autor #"+p(d.value.autor_id),1)]),_:1})]),_:1}),a(e(D),{color:F(d.value.category)},{default:l(()=>[a(e(z),null,{default:l(()=>[f(p(d.value.category),1)]),_:1})]),_:1},8,["color"])]),c("div",Ye,[t[19]||(t[19]=c("h3",null,"Ingredientes",-1)),c("ul",null,[(g(!0),k(B,null,L(j(d.value.ingredients),(i,b)=>(g(),k("li",{key:b},p(i),1))),128))])]),c("div",Ze,[t[20]||(t[20]=c("h3",null,"Pasos",-1)),c("ol",null,[(g(!0),k(B,null,L(j(d.value.steps),(i,b)=>(g(),k("li",{key:b},p(i),1))),128))])])]),_:1})):P("",!0)]),_:1},8,["is-open"]),a(e(Pe),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:l(()=>[a(e(Q),{"router-link":"/recipes/new"},{default:l(()=>[a(e(I),{icon:e(Ee)},null,8,["icon"])]),_:1})]),_:1})]),_:1}))}}),lt=Oe(et,[["__scopeId","data-v-19330db6"]]);export{lt as default};
