System.register(["./index-legacy-BLxyB22v.js","./_plugin-vue_export-helper-legacy-BVIICed7.js"],function(e,a){"use strict";var l,t,n,i,o,d,r,s,u,c,p,v,f,m,y,b,g,_,x,k,h,w,D,P,C,$,S,V,z,E,N,L,R,j,M,T,G,I,U,q,A,Y,B,F,H,J,K,Q;return{setters:[e=>{l=e.d,t=e.r,n=e.u,i=e.c,o=e.E,d=e.af,r=e.ag,s=e.C,u=e.b,c=e.w,p=e.e,v=e.o,f=e.g,m=e.I,y=e.h,b=e.i,g=e.j,_=e.z,x=e.x,k=e.G,h=e.ah,w=e.ai,D=e.l,P=e.aj,C=e.v,$=e.ak,S=e.k,V=e.n,z=e.al,E=e.P,N=e.Q,L=e.am,R=e.p,j=e.X,M=e.a9,T=e.q,G=e.s,I=e.a3,U=e.ad,q=e.ae,A=e.a0,Y=e.K,B=e.L,F=e.a7,H=e.a8,J=e.t,K=e.y},e=>{Q=e._}],execute:function(){var a=document.createElement("style");a.textContent=".week-navigation[data-v-5dfc6b52]{display:flex;align-items:center;justify-content:center;gap:8px;padding:8px}.week-label[data-v-5dfc6b52]{font-weight:700;min-width:150px;text-align:center}.day-section[data-v-5dfc6b52]{margin-bottom:20px;background:var(--ion-card-background, #fff);border-radius:12px;padding:10px;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:all .3s ease}.day-section.today[data-v-5dfc6b52]{border:2px solid var(--ion-color-primary);box-shadow:0 4px 16px rgba(72,199,142,.3)}.day-section.past[data-v-5dfc6b52]{opacity:.6;background:rgba(128,128,128,.1)}.day-header[data-v-5dfc6b52]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(128,128,128,.2);padding-bottom:5px;margin-bottom:5px}.day-header h2[data-v-5dfc6b52]{font-size:1.2rem;font-weight:700;margin:0;color:var(--ion-color-primary)}.date-label[data-v-5dfc6b52]{color:var(--ion-color-medium);font-size:.85rem;display:flex;align-items:center;gap:6px}.today-badge[data-v-5dfc6b52],.past-badge[data-v-5dfc6b52]{font-size:.7rem;padding:2px 6px}.empty-day[data-v-5dfc6b52]{text-align:center;color:#888;font-style:italic;padding:10px}.info-box[data-v-5dfc6b52]{background:rgba(72,199,142,.1);border-left:4px solid var(--ion-color-primary);padding:12px;border-radius:8px;font-size:.9rem}.info-box p[data-v-5dfc6b52]{margin:4px 0}.meal-item[data-v-5dfc6b52]{animation:fadeIn-5dfc6b52 .3s ease}.past-meal[data-v-5dfc6b52]{opacity:.7}.past-meal ion-button[disabled][data-v-5dfc6b52]{opacity:.3}@keyframes fadeIn-5dfc6b52{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}\n/*$vite$:1*/",document.head.appendChild(a);const X={class:"week-navigation"},O={class:"week-label"},W={class:"day-header"},Z={class:"date-label"},ee={key:0},ae={key:1},le={key:1,class:"empty-day"},te={key:0},ne={key:1},ie={key:0},oe={key:1,class:"ion-padding ion-text-center"},de={key:1},re={class:"ion-padding"};e("default",Q(l({__name:"MealPlannerPage",setup(e){const a=t([]),l=t(!1),Q=t(""),se=t("recipe"),ue=t([]),ce=t(null),pe=t(new Date),ve=t(!1),fe=t("");let me=null;const ye=t({type:"lunch",recipe_id:null,description:""}),be=n(),ge=i(()=>{return"recipe"===se.value?!!ye.value.recipe_id:!(null===(e=ye.value.description)||void 0===e||!e.trim());var e});function _e(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function xe(){return _e(new Date)}function ke(e){return e<xe()}const he=i(()=>{const e=[],a=new Date(pe.value);a.setHours(0,0,0,0);const l=new Date(a);l.setDate(a.getDate()-a.getDay()+(0===a.getDay()?-6:1));const t=xe();for(let n=0;n<7;n++){const a=new Date(l);a.setDate(l.getDate()+n);const i=_e(a),o=i===t,d=ke(i);e.push({date:i,dayName:Le(a),dateLabel:Re(a),isToday:o,isPast:d})}return e}),we=i(()=>{var e,a;return`${(null===(e=he.value[0])||void 0===e?void 0:e.dateLabel)||""} - ${(null===(a=he.value[6])||void 0===a?void 0:a.dateLabel)||""}`}),De=i(()=>{if(!Q.value)return"";const e=new Date(Q.value+"T00:00:00");return`${Le(e)} ${Re(e)}`});async function Pe(){try{var e,l,t;const n=null===(e=s.authStore.model)||void 0===e?void 0:e.id;if(!n)return;const i=null===(l=he.value[0])||void 0===l?void 0:l.date,o=null===(t=he.value[6])||void 0===t?void 0:t.date;console.log("Loading meals for week:",i,"to",o);const d=await s.collection("meal_plans").getFullList({filter:`user = "${n}" && date >= "${i}" && date <= "${o}"`,expand:"recipe",sort:"date,type"});console.log("Loaded",d.length,"meals:",d),a.value=d}catch(n){console.error(n)}}function Ce(){me&&(me(),me=null)}function $e(e){return a.value.filter(a=>a.date===e)}function Se(){pe.value=new Date,Pe()}function Ve(){const e=new Date(pe.value);e.setDate(e.getDate()-7),pe.value=e,Pe()}function ze(){const e=new Date(pe.value);e.setDate(e.getDate()+7),pe.value=e,Pe()}function Ee(){l.value=!1,ce.value=null}async function Ne(){try{var e,a;const t=null===(e=s.authStore.model)||void 0===e?void 0:e.id;if(!t)return void alert("Debes iniciar sesiÃ³n");if(ke(Q.value))return void alert("âš ï¸ No puedes crear o editar planes para dÃ­as pasados");if("recipe"===se.value&&!ye.value.recipe_id)return void alert("Por favor, selecciona una receta");if("manual"===se.value&&(null===(a=ye.value.description)||void 0===a||!a.trim()))return void alert("Por favor, escribe una descripciÃ³n");const n={user:t,date:Q.value,type:ye.value.type,recipe:"recipe"===se.value?ye.value.recipe_id:null,description:"manual"===se.value?ye.value.description:null};ce.value?await s.collection("meal_plans").update(ce.value.id,n):await s.collection("meal_plans").create(n),l.value=!1,ce.value=null,await Pe()}catch(n){var t;console.error("Error completo:",n);const e=(null===(t=n.data)||void 0===t?void 0:t.message)||n.message||"Error desconocido";alert(`Error al guardar: ${e}`)}}function Le(e){return["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"][e.getDay()]}function Re(e){return`${e.getDate()}/${e.getMonth()+1}`}return o(()=>{Se(),async function(){0===be.myRecipes.length&&await be.fetchProfile();const e=[...be.myRecipes||[],...be.savedRecipes||[]];ue.value=e}(),async function(){try{var e;const a=null===(e=s.authStore.model)||void 0===e?void 0:e.id;if(!a)return;me=await s.collection("meal_plans").subscribe("*",e=>{console.log("Realtime event:",e.action),e.record.user===a&&("create"===e.action?(fe.value="âœ… Nuevo plan aÃ±adido",ve.value=!0):"update"===e.action?(fe.value="âœï¸ Plan actualizado",ve.value=!0):"delete"===e.action&&(fe.value="ðŸ—‘ï¸ Plan eliminado",ve.value=!0),Pe())})}catch(a){console.error("Error subscribing to realtime:",a)}}()}),d(()=>{Ce()}),r(()=>{Ce()}),(e,a)=>(v(),u(p(K),null,{default:c(()=>[f(p(m),null,{default:c(()=>[f(p(y),null,{default:c(()=>[f(p(b),null,{default:c(()=>[...a[5]||(a[5]=[g("MenÃº Semanal",-1)])]),_:1}),f(p(_),{slot:"end"},{default:c(()=>[f(p(x),{onClick:Se},{default:c(()=>[f(p(k),{icon:p(h),slot:"icon-only"},null,8,["icon"])]),_:1}),f(p(x),{onClick:Pe},{default:c(()=>[f(p(k),{icon:p(w),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),f(p(y),null,{default:c(()=>[D("div",X,[f(p(x),{fill:"clear",onClick:Ve},{default:c(()=>[f(p(k),{icon:p(P)},null,8,["icon"])]),_:1}),D("span",O,C(we.value),1),f(p(x),{fill:"clear",onClick:ze},{default:c(()=>[f(p(k),{icon:p($)},null,8,["icon"])]),_:1})])]),_:1})]),_:1}),f(p(S),{class:"ion-padding"},{default:c(()=>[f(p(z),{"is-open":ve.value,message:fe.value,duration:3e3,position:"top",color:"success",onDidDismiss:a[0]||(a[0]=e=>ve.value=!1)},null,8,["is-open","message"]),(v(!0),V(E,null,N(he.value,e=>(v(),V("div",{key:e.date,class:L(["day-section",{today:e.isToday,past:e.isPast}])},[D("div",W,[D("div",null,[D("h2",null,C(e.dayName),1),D("small",Z,[g(C(e.dateLabel)+" ",1),e.isToday?(v(),u(p(j),{key:0,color:"success",class:"today-badge"},{default:c(()=>[...a[6]||(a[6]=[g("Hoy",-1)])]),_:1})):R("",!0),e.isPast?(v(),u(p(j),{key:1,color:"medium",class:"past-badge"},{default:c(()=>[...a[7]||(a[7]=[g("Pasado",-1)])]),_:1})):R("",!0)])]),f(p(x),{fill:"clear",size:"small",onClick:a=>{var t;ke(t=e.date)?alert("âš ï¸ No puedes crear planes para dÃ­as pasados"):(ce.value=null,Q.value=t,ye.value={type:"lunch",recipe_id:null,description:""},se.value="recipe",l.value=!0)},disabled:e.isPast,title:e.isPast?"No puedes aÃ±adir planes a dÃ­as pasados":"AÃ±adir plan"},{default:c(()=>[f(p(k),{icon:p(M),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick","disabled","title"])]),$e(e.date).length?(v(),u(p(T),{key:0,lines:"none"},{default:c(()=>[(v(!0),V(E,null,N($e(e.date),a=>(v(),u(p(G),{key:a.id,class:L(["meal-item",{"past-meal":e.isPast}])},{default:c(()=>[f(p(I),{class:"ion-text-wrap"},{default:c(()=>{var e,l;return[D("h3",null,C((l=a.type,"lunch"===l?"Comida":"Cena")),1),null!==(e=a.expand)&&void 0!==e&&e.recipe?(v(),V("p",ee,"ðŸ½ï¸ "+C(a.expand.recipe.title),1)):(v(),V("p",ae,"ðŸ“ "+C(a.description),1))]}),_:2},1024),f(p(x),{fill:"clear",color:"primary",slot:"end",onClick:t=>function(e,a){a?alert("âš ï¸ No puedes editar planes de dÃ­as pasados"):(ce.value=e,Q.value=e.date,ye.value={type:e.type,recipe_id:e.recipe||null,description:e.description||""},se.value=e.recipe?"recipe":"manual",l.value=!0)}(a,e.isPast),disabled:e.isPast,title:e.isPast?"No puedes editar planes pasados":"Editar"},{default:c(()=>[f(p(k),{icon:p(U),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick","disabled","title"]),f(p(x),{fill:"clear",color:"danger",slot:"end",onClick:l=>async function(e,a){if(a)alert("âš ï¸ No puedes eliminar planes de dÃ­as pasados");else if(confirm("Â¿Borrar plan de comida?"))try{await s.collection("meal_plans").delete(e),await Pe()}catch(l){alert("Error al borrar")}}(a.id,e.isPast),disabled:e.isPast,title:e.isPast?"No puedes borrar planes pasados":"Borrar"},{default:c(()=>[f(p(k),{icon:p(q),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick","disabled","title"])]),_:2},1032,["class"]))),128))]),_:2},1024)):(v(),V("div",le,[e.isPast?(v(),V("small",te,"DÃ­a pasado - Sin registro")):(v(),V("small",ne,"Sin planes"))]))],2))),128)),f(p(A),{"is-open":l.value,onDidDismiss:Ee},{default:c(()=>[f(p(m),null,{default:c(()=>[f(p(y),null,{default:c(()=>[f(p(b),null,{default:c(()=>[g(C(ce.value?"Editar":"AÃ±adir")+" - "+C(De.value),1)]),_:1}),f(p(_),{slot:"end"},{default:c(()=>[f(p(x),{onClick:Ee},{default:c(()=>[...a[8]||(a[8]=[g("Cancelar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),f(p(S),{class:"ion-padding"},{default:c(()=>[f(p(G),null,{default:c(()=>[f(p(Y),{label:"Tipo",modelValue:ye.value.type,"onUpdate:modelValue":a[1]||(a[1]=e=>ye.value.type=e),interface:"popover"},{default:c(()=>[f(p(B),{value:"lunch"},{default:c(()=>[...a[9]||(a[9]=[g("Comida",-1)])]),_:1}),f(p(B),{value:"dinner"},{default:c(()=>[...a[10]||(a[10]=[g("Cena",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[15]||(a[15]=D("div",{class:"info-box ion-margin-vertical"},[D("p",null,[D("strong",null,"ðŸ½ï¸ Receta Guardada:"),g(" Vincula una receta que ya tienes")]),D("p",null,[D("strong",null,"ðŸ“ Manual:"),g(' Escribe texto libre (ej: "Pizza fuera")')])],-1)),f(p(F),{modelValue:se.value,"onUpdate:modelValue":a[2]||(a[2]=e=>se.value=e),class:"ion-margin-vertical"},{default:c(()=>[f(p(H),{value:"recipe"},{default:c(()=>[...a[11]||(a[11]=[g("Receta Guardada",-1)])]),_:1}),f(p(H),{value:"manual"},{default:c(()=>[...a[12]||(a[12]=[g("Manual",-1)])]),_:1})]),_:1},8,["modelValue"]),"recipe"===se.value?(v(),V("div",ie,[ue.value.length?(v(),u(p(G),{key:0},{default:c(()=>[f(p(Y),{label:"Elige Receta",modelValue:ye.value.recipe_id,"onUpdate:modelValue":a[3]||(a[3]=e=>ye.value.recipe_id=e),placeholder:"Selecciona una receta",interface:"alert"},{default:c(()=>[(v(!0),V(E,null,N(ue.value,e=>(v(),u(p(B),{key:e.id,value:e.id},{default:c(()=>[g(C(e.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(v(),V("div",oe,[a[14]||(a[14]=D("p",null,"No tienes recetas.",-1)),f(p(x),{size:"small","router-link":"/recipes/new"},{default:c(()=>[...a[13]||(a[13]=[g("Crear Receta",-1)])]),_:1})]))])):(v(),V("div",de,[f(p(G),null,{default:c(()=>[f(p(J),{label:"DescripciÃ³n","label-placement":"floating",modelValue:ye.value.description,"onUpdate:modelValue":a[4]||(a[4]=e=>ye.value.description=e),placeholder:"Ej: Pizza fuera, Sobras, Restaurante...",required:""},null,8,["modelValue"])]),_:1})])),D("div",re,[f(p(x),{expand:"block",onClick:Ne,disabled:!ge.value},{default:c(()=>[g(C(ce.value?"Actualizar":"Guardar"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-5dfc6b52"]]))}}});
