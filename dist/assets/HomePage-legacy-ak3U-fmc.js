System.register(["./index-legacy-BLxyB22v.js","./_plugin-vue_export-helper-legacy-BVIICed7.js"],function(e,t){"use strict";var a,l,i,n,o,r,s,c,d,u,p,f,g,h,v,m,y,x,_,b,k,w,C,R,E,I,P,S,z,j,T,V,A,D,$,q,L,U,O,N,B,J,M,W,F,G,H,K,Q,X,Y,Z,ee,te,ae,le;return{setters:[e=>{a=e.B,l=e.C,i=e.d,n=e.D,o=e.u,r=e.r,s=e.E,c=e.b,d=e.w,u=e.e,p=e.f,f=e.o,g=e.g,h=e.I,v=e.h,m=e.z,y=e.x,x=e.l,_=e.F,b=e.v,k=e.G,w=e.H,C=e.J,R=e.K,E=e.L,I=e.j,P=e.k,S=e.n,z=e.p,j=e.M,T=e.N,V=e.O,A=e.P,D=e.Q,$=e.R,q=e.S,L=e.T,U=e.m,O=e.U,N=e.V,B=e.W,J=e.X,M=e.Y,W=e.Z,F=e._,G=e.$,H=e.a0,K=e.i,Q=e.a1,X=e.a2,Y=e.a3,Z=e.a4,ee=e.a5,te=e.a6,ae=e.y},e=>{le=e._}],execute:function(){var t=document.createElement("style");t.textContent=".recipe-card[data-v-19330db6]{height:100%;display:flex;flex-direction:column;margin:0;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.3);background:var(--ion-color-secondary)}.image-container[data-v-19330db6]{width:100%;height:160px;overflow:hidden;position:relative}.image-container img[data-v-19330db6]{width:100%;height:100%;object-fit:cover;transition:transform .4s ease}.recipe-card:hover .image-container img[data-v-19330db6]{transform:scale(1.05)}.bookmark-fab[data-v-19330db6]{position:absolute;top:8px;left:8px;z-index:10;--box-shadow: 0 2px 8px rgba(0,0,0,.3)}ion-card-header[data-v-19330db6]{padding:12px}.badges[data-v-19330db6]{position:absolute;top:10px;right:10px;z-index:2}.meta-row[data-v-19330db6]{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}.details-section[data-v-19330db6]{background:rgba(255,255,255,.05);border-radius:12px;padding:16px;margin-bottom:16px;text-align:left}.pagination-controls[data-v-19330db6]{display:flex;align-items:center;justify-content:center;gap:16px}.page-info[data-v-19330db6]{font-weight:700}\n/*$vite$:1*/",document.head.appendChild(t);const ie=a("recipes",{state:()=>({items:[],total:0,totalPages:1,page:1,limit:8,loading:!1,error:null,filters:{q:"",categoria:"",dificultad:""},selectedRecipe:null,detailsLoading:!1,detailsError:null}),actions:{async fetchRecipes(e={}){const t=e.append||!1;t||(this.loading=!0,this.items=[]),this.error=null,e.page&&(this.page=e.page);try{const e=[];this.filters.q&&e.push(`title ~ "${this.filters.q}"`),this.filters.categoria&&e.push(`category = "${this.filters.categoria}"`),this.filters.dificultad&&e.push(`difficulty = "${this.filters.dificultad}"`);const a=e.length>0?e.join(" && "):"",i=await l.collection("recipes").getList(this.page,this.limit,{filter:a,sort:"-created",expand:"author"}),n=i.items;this.items=t?[...this.items,...n]:n,this.page=i.page,this.totalPages=i.totalPages,this.total=i.totalItems}catch(a){this.error=a.message||"Error al cargar recetas",t||(this.items=[])}finally{this.loading=!1}},setSearch(e){this.filters.q=e,this.page=1},async goToPage(e){e<1||e>this.totalPages||(this.page=e,await this.fetchRecipes())},async fetchRecipeDetails(e){this.detailsLoading=!0,this.detailsError=null,this.selectedRecipe=null;try{const t=await l.collection("recipes").getOne(e,{expand:"author"});this.selectedRecipe=t}catch(t){this.detailsError=t.message||"Error al cargar detalles de la receta"}finally{this.detailsLoading=!1}},clearSelected(){this.selectedRecipe=null,this.detailsError=null}}});async function ne(e,t,a={}){const{body:l,params:i,auth:n}=a,o=new URL("/api"+t,window.location.origin);i&&Object.entries(i).forEach(([e,t])=>{null!=t&&""!==t&&o.searchParams.append(e,String(t))});const r={};if(null!=l&&(r["Content-Type"]="application/json"),n){const e=function(){const e=localStorage.getItem("token");return e&&"undefined"!==e&&"null"!==e?e:null}();if(!e)throw console.warn("API: Token required but not found in localStorage"),new Error("Token requerido");r.Authorization=`Bearer ${e}`}const s=await fetch(o.toString(),{method:e,headers:r,body:null!=l?JSON.stringify(l):void 0});let c=null;const d=s.headers.get("content-type"),u=d&&d.includes("application/json");if(204!==s.status&&u&&(c=await s.json()),!s.ok){var p,f;const e=(null===(p=c)||void 0===p?void 0:p.error)||(null===(f=c)||void 0===f?void 0:f.message)||`Error ${s.status}`,t=new Error(e);throw t.status=s.status,t.data=c,t}return c}const oe={get:(e,t={})=>ne("GET",e,t),delete:(e,t={})=>ne("DELETE",e,t),post:(e,t,a={})=>ne("POST",e,{...a,body:t}),put:(e,t,a={})=>ne("PUT",e,{...a,body:t})},re=["src"],se={style:{"font-size":"0.8rem"}},ce={style:{display:"flex",gap:"10px",padding:"0 16px","align-items":"center"}},de={key:0,class:"ion-text-center ion-padding"},ue={key:1,class:"ion-text-center ion-padding color-danger"},pe=["onClick"],fe=["src"],ge={class:"badges"},he={style:{display:"flex","align-items":"center",gap:"5px"}},ve={key:3,class:"ion-text-center ion-padding pagination-controls"},me={class:"page-info"},ye={key:4,class:"ion-text-center ion-padding muted"},xe={class:"ion-text-center"},_e=["src"],be={class:"ion-text-center"},ke={class:"meta-row"},we={class:"details-section"},Ce={class:"details-section"};e("default",le(i({__name:"HomePage",setup(e){const t=p(),a=ie(),{items:l,loading:i,page:le,totalPages:ne,filters:Re}=n(a),Ee=o(),Ie=r(!1),Pe=r(null);function Se(){a.page=1,a.fetchRecipes()}async function ze(e){e<1||e>ne.value||await a.fetchRecipes({page:e})}async function je(e){try{const t=await oe.get(`/recipes/${e.id}`);Pe.value=t.recipe||t,Ie.value=!0}catch(t){console.error(t),Pe.value=e,Ie.value=!0}}function Te(){Ie.value=!1,Pe.value=null}async function Ve(e){if(Ee.user)try{await Ee.toggleSaved(e.id)}catch(t){alert(t.message||"Error al guardar receta")}else alert("Inicia sesión para guardar recetas")}function Ae(e){return e&&(e.startsWith("http://")||e.startsWith("https://"))?e:"https://via.placeholder.com/300x200?text=Receta"}function De(e){e.target.src="https://via.placeholder.com/300x200?text=Receta"}function $e(e){if(!e)return[];if(Array.isArray(e))return e;if("string"==typeof e)try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}return[]}function qe(e){switch(e){case"entrante":return"success";case"principal":return"warning";case"postre":return"tertiary";default:return"medium"}}function Le(){Ee.logout(),t.replace("/login")}return s(()=>{!async function(){await a.fetchRecipes({page:1}),Ee.user&&await Ee.fetchProfile()}()}),(e,t)=>(f(),c(u(ae),null,{default:d(()=>[g(u(h),null,{default:d(()=>[g(u(v),null,{default:d(()=>[g(u(m),{slot:"start"},{default:d(()=>[g(u(y),{onClick:e.reload,fill:"clear",color:"dark"},{default:d(()=>[...t[7]||(t[7]=[x("strong",null,"Recetas",-1)])]),_:1},8,["onClick"])]),_:1}),g(u(m),{slot:"end"},{default:d(()=>[g(u(y),{"router-link":"/tabs/profile",style:{display:"flex","align-items":"center",gap:"8px"}},{default:d(()=>{var e;return[g(u(_),{style:{width:"32px",height:"32px"}},{default:d(()=>{return[x("img",{src:null!==(e=Ee.user)&&void 0!==e&&e.avatar?Ee.user.avatar:"https://ui-avatars.com/api/?name="+encodeURIComponent((null===(t=Ee.user)||void 0===t?void 0:t.name)||(null===(a=Ee.user)||void 0===a?void 0:a.email)||"Usuario")+"&background=random",alt:"Avatar"},null,8,re)];var e,t,a}),_:1}),x("span",se,b((null===(e=u(Ee).user)||void 0===e?void 0:e.name)||"Mi Perfil"),1)]}),_:1}),g(u(y),{onClick:Le},{default:d(()=>[g(u(k),{icon:u(w)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),g(u(v),null,{default:d(()=>[g(u(C),{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=t=>e.search=t),placeholder:"Buscar recetas...",onIonInput:e.onSearchInput},null,8,["modelValue","onIonInput"])]),_:1}),g(u(v),null,{default:d(()=>[x("div",ce,[g(u(R),{modelValue:u(a).filters.categoria,"onUpdate:modelValue":t[1]||(t[1]=e=>u(a).filters.categoria=e),label:"Categoría","label-placement":"floating",fill:"outline",interface:"popover",style:{flex:"1"},onIonChange:Se},{default:d(()=>[g(u(E),{value:""},{default:d(()=>[...t[8]||(t[8]=[I("Todas",-1)])]),_:1}),g(u(E),{value:"entrante"},{default:d(()=>[...t[9]||(t[9]=[I("Entrante",-1)])]),_:1}),g(u(E),{value:"principal"},{default:d(()=>[...t[10]||(t[10]=[I("Principal",-1)])]),_:1}),g(u(E),{value:"postre"},{default:d(()=>[...t[11]||(t[11]=[I("Postre",-1)])]),_:1})]),_:1},8,["modelValue"]),g(u(R),{modelValue:u(a).filters.dificultad,"onUpdate:modelValue":t[2]||(t[2]=e=>u(a).filters.dificultad=e),label:"Dificultad","label-placement":"floating",fill:"outline",interface:"popover",style:{flex:"1"},onIonChange:Se},{default:d(()=>[g(u(E),{value:""},{default:d(()=>[...t[12]||(t[12]=[I("Todas",-1)])]),_:1}),g(u(E),{value:"facil"},{default:d(()=>[...t[13]||(t[13]=[I("Fácil",-1)])]),_:1}),g(u(E),{value:"media"},{default:d(()=>[...t[14]||(t[14]=[I("Media",-1)])]),_:1}),g(u(E),{value:"dificil"},{default:d(()=>[...t[15]||(t[15]=[I("Difícil",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),g(u(P),{class:"ion-padding"},{default:d(()=>[u(i)&&!u(l).length?(f(),S("div",de,[g(u(j))])):z("",!0),e.error?(f(),S("div",ue,b(e.error),1)):z("",!0),u(l).length?(f(),c(u(T),{key:2},{default:d(()=>[g(u(V),null,{default:d(()=>[(f(!0),S(A,null,D(u(l),e=>(f(),c(u($),{size:"12","size-sm":"6","size-md":"4","size-lg":"3",key:e.id},{default:d(()=>[g(u(q),{button:"",class:"recipe-card"},{default:d(()=>[x("div",{class:"image-container",onClick:t=>je(e)},[x("img",{src:Ae(e.image),onError:De,alt:"Recipe image"},null,40,fe),g(u(L),{size:"small",class:"bookmark-fab",onClick:U(t=>Ve(e),["stop"]),color:u(Ee).savedRecipeIds.has(e.id)?"warning":"light"},{default:d(()=>[g(u(k),{icon:u(Ee).savedRecipeIds.has(e.id)?u(O):u(N)},null,8,["icon"])]),_:2},1032,["onClick","color"])],8,pe),g(u(B),{onClick:t=>je(e)},{default:d(()=>[x("div",ge,[g(u(J),{color:qe(e.category)},{default:d(()=>[I(b(e.category),1)]),_:2},1032,["color"])]),g(u(M),{style:{"font-size":"1.1rem"}},{default:d(()=>[I(b(e.title),1)]),_:2},1024),g(u(W),null,{default:d(()=>[x("span",he,[g(u(k),{icon:u(F),color:"warning",style:{"vertical-align":"text-bottom"}},null,8,["icon"]),I(" "+b(e.time)+" min | ",1),g(u(k),{icon:u(G),color:"success",style:{"vertical-align":"text-bottom"}},null,8,["icon"]),I(" "+b(e.difficulty),1)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):z("",!0),u(l).length||u(le)>1?(f(),S("div",ve,[g(u(y),{fill:"clear",disabled:u(le)<=1,onClick:t[3]||(t[3]=e=>ze(u(le)-1))},{default:d(()=>[...t[16]||(t[16]=[I(" < Anterior ",-1)])]),_:1},8,["disabled"]),x("span",me,"Página "+b(u(le))+" de "+b(u(ne)),1),g(u(y),{fill:"clear",disabled:u(le)>=u(ne),onClick:t[4]||(t[4]=e=>ze(u(le)+1))},{default:d(()=>[...t[17]||(t[17]=[I(" Siguiente > ",-1)])]),_:1},8,["disabled"])])):u(a).loading?z("",!0):(f(),S("div",ye," No hay recetas que coincidan con tu búsqueda. "))]),_:1}),g(u(H),{"is-open":Ie.value,onDidDismiss:Te},{default:d(()=>[g(u(h),null,{default:d(()=>[g(u(v),null,{default:d(()=>[g(u(K),null,{default:d(()=>{var e;return[I(b(null===(e=Pe.value)||void 0===e?void 0:e.titulo),1)]}),_:1}),g(u(m),{slot:"end"},{default:d(()=>{var e,a;return[u(Ee).user&&(a=null===(e=Pe.value)||void 0===e?void 0:e.id,Ee.savedRecipeIds.has(a))?(f(),c(u(y),{key:0,color:"warning",onClick:t[5]||(t[5]=e=>Ve(Pe.value))},{default:d(()=>[g(u(k),{icon:u(O),slot:"icon-only"},null,8,["icon"])]),_:1})):u(Ee).user?(f(),c(u(y),{key:1,onClick:t[6]||(t[6]=e=>Ve(Pe.value))},{default:d(()=>[g(u(k),{icon:u(N),slot:"icon-only"},null,8,["icon"])]),_:1})):z("",!0),g(u(y),{onClick:Te},{default:d(()=>[...t[18]||(t[18]=[I("Cerrar",-1)])]),_:1})]}),_:1})]),_:1})]),_:1}),Pe.value?(f(),c(u(P),{key:0,class:"ion-padding"},{default:d(()=>[x("div",xe,[x("img",{src:Ae(Pe.value.image),style:{"max-height":"250px","border-radius":"12px"},onError:De,alt:"Recipe image"},null,40,_e)]),x("h2",be,b(Pe.value.title),1),x("div",ke,[g(u(Q),null,{default:d(()=>[g(u(k),{icon:u(X)},null,8,["icon"]),g(u(Y),null,{default:d(()=>{return[I(b((e=Pe.value.created_at,e?new Date(e).toLocaleDateString():"")),1)];var e}),_:1})]),_:1}),g(u(Q),null,{default:d(()=>[g(u(k),{icon:u(Z)},null,8,["icon"]),g(u(Y),null,{default:d(()=>[I("Autor #"+b(Pe.value.autor_id),1)]),_:1})]),_:1}),g(u(Q),{color:qe(Pe.value.category)},{default:d(()=>[g(u(Y),null,{default:d(()=>[I(b(Pe.value.category),1)]),_:1})]),_:1},8,["color"])]),x("div",we,[t[19]||(t[19]=x("h3",null,"Ingredientes",-1)),x("ul",null,[(f(!0),S(A,null,D($e(Pe.value.ingredients),(e,t)=>(f(),S("li",{key:t},b(e),1))),128))])]),x("div",Ce,[t[20]||(t[20]=x("h3",null,"Pasos",-1)),x("ol",null,[(f(!0),S(A,null,D($e(Pe.value.steps),(e,t)=>(f(),S("li",{key:t},b(e),1))),128))])])]),_:1})):z("",!0)]),_:1},8,["is-open"]),g(u(ee),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:d(()=>[g(u(L),{"router-link":"/recipes/new"},{default:d(()=>[g(u(k),{icon:u(te)},null,8,["icon"])]),_:1})]),_:1})]),_:1}))}}),[["__scopeId","data-v-19330db6"]]))}}});
